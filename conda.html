<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>conda &#8212; dotfiles  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/plugin_metadata.css?v=114a3185" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Post-setup tasks" href="post.html" />
    <link rel="prev" title="tmux configuration" href="tmux.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tmux.html" title="Previous document">tmux configuration</a>
        </li>
        <li>
          <a href="post.html" title="Next document">Post-setup tasks</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="conda">
<h1>conda<a class="headerlink" href="#conda" title="Link to this heading">¶</a></h1>
<section id="installing-conda">
<h2>Installing conda<a class="headerlink" href="#installing-conda" title="Link to this heading">¶</a></h2>
<p>To install conda, we use <a class="reference external" href="https://github.com/conda-forge/miniforge">Miniforge</a>. Miniforge is a way of installing
conda that sets conda-forge as the default (and only) channel, and it includes
<code class="docutils literal notranslate"><span class="pre">mamba</span></code>, a drop-in replacement for conda that is faster and more
feature-complete.</p>
</section>
<section id="don-t-run-conda-init-bash">
<h2>Don’t run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span> <span class="pre">bash</span></code><a class="headerlink" href="#don-t-run-conda-init-bash" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TL;DR: use <code class="docutils literal notranslate"><span class="pre">ca</span></code> to activate an environment. See below for why.</p>
</div>
<p>Usually, after installing conda, you would typically run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span> <span class="pre">bash</span></code>.
<strong>These dotfiles are set up to explicitly avoid that here.</strong></p>
<p>Why? First, because this adds lines to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> file (if on Linux) or
your <code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code> file (if on Mac). Thereafter, every single new bash
session runs that code…which involves importing some Python libraries and
running conda itself. Since the conda Python module loads other modules, and
those modules load still others, every time a bash session is started, many
files are touched.</p>
<p>Why is this a problem?</p>
<p>Reading many files on every bash session can cause I/O slowdown in
a high-performance computing environment (like NIH’s Biowulf) when many jobs
are kicked off simultaneously. So we want to avoid this on HPC environments.
This I/O load is not an issue on a personal machine,since it’s unlikely that
you’ll be starting so many bash sessions.</p>
<p>Second, you may find that on tmux, when you create a new pane or window, your
prompt still indicates that you’re in a conda environment, but running <code class="docutils literal notranslate"><span class="pre">which</span>
<span class="pre">python</span></code> returns the <em>system</em> Python. It turns out that this is because tmux
prepends the system path to the PATH when creating a new pane or window. The
solution is to run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">deactivate</span></code> a bunch of times, until the prompt no
longer has the <code class="docutils literal notranslate"><span class="pre">(env_name)</span></code> indicator in it, and <em>then</em> activate the
environment you want.</p>
</section>
<section id="the-solution">
<h2>The solution<a class="headerlink" href="#the-solution" title="Link to this heading">¶</a></h2>
<p>These dotfiles provide <code class="docutils literal notranslate"><span class="pre">ca</span></code> (short for “conda activate”) which activates
conda on demand only when you need it, rather than automatically activating
upon starting every shell. This avoids I/O slowdown and tmux issues.</p>
<ol class="arabic">
<li><p><strong>To activate an environment, use</strong> <code class="docutils literal notranslate"><span class="pre">ca</span></code> at the time you want to use it.
Use <code class="docutils literal notranslate"><span class="pre">ca</span></code> by itself to activate the base environment. Use <code class="docutils literal notranslate"><span class="pre">ca</span> <span class="pre">&lt;envname&gt;</span></code> to
activate a specific environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># activate named environment</span>
ca<span class="w"> </span>myenv

<span class="c1"># activate environment at path</span>
ca<span class="w"> </span>./env
</pre></div>
</div>
</li>
<li><p>Every new tmux pane starts with everything deactivated.</p></li>
</ol>
</section>
<section id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Link to this heading">¶</a></h2>
<p>These dotfiles provide a function, <code class="docutils literal notranslate"><span class="pre">ca</span></code> (short for “conda activate”). It’s
defined in the <code class="file docutils literal notranslate"><span class="pre">~/.functions</span></code> file which in turn is sourced in
<code class="file docutils literal notranslate"><span class="pre">~/.bashrc</span></code>. This function runs <code class="docutils literal notranslate"><span class="pre">eval</span> <span class="pre">&quot;$(conda</span> <span class="pre">shell.bash</span> <span class="pre">hook)&quot;</span></code>,
which is a way of running the same commands that <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span> <span class="pre">bash</span></code> would add
to your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>. <strong>But it runs it on demand, not every shell.</strong> In other
words, this is wrapping the <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span> <span class="pre">bash</span></code> stuff inside a function that we
only call when we need it.</p>
<p>The file <code class="file docutils literal notranslate"><span class="pre">.functions</span></code> also has a <code class="docutils literal notranslate"><span class="pre">conda_deactivate_all</span></code> function, which
keeps running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">deactivate</span></code> until there’s no activated environment (this
idea is from <a class="reference external" href="https://stackoverflow.com/a/76304995">this SO answer</a>). You
typically won’t run this on your own much, but theres a line in <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>
that runs <code class="docutils literal notranslate"><span class="pre">conda_deactivate_all</span></code> if we’re in a tmux session, so it will run
on each new tmux pane. You’ll need to activate the environment again in the new
pane.</p>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tmux.html" title="Previous document">tmux configuration</a>
        </li>
        <li>
          <a href="post.html" title="Next document">Post-setup tasks</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">dotfiles</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="starthere.html">Start here</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Additional tool installations</a></li>
<li class="toctree-l1"><a class="reference internal" href="bash.html">Bash dotfiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="vim.html">Vim (neovim) configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="nvim-plugins.html">Nvim plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="tmux.html">tmux configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">conda</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-conda">Installing conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-run-conda-init-bash">Don’t run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span> <span class="pre">bash</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-solution">The solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-it-works">How it works</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="post.html">Post-setup tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="nvim-lua.html">Migrating to Neovim Lua config</a></li>
<li class="toctree-l1"><a class="reference internal" href="why.html">Why?</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tmux.html" title="previous chapter">tmux configuration</a></li>
      <li>Next: <a href="post.html" title="next chapter">Post-setup tasks</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div><script>
    let closest;
    // Get the last part of the URL after the # symbol - should match the div id to display
    let id = window.location.hash.substring(1);
    let elem = document.getElementById(id);
    if (elem != null) {
        // Get the closest "details" element and open it
        closest = elem.closest("details");
        closest.open = true;
    }
</script>
  </body>
</html>